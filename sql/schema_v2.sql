-- -- ======================================================================
-- -- DROPS (seguros): ignora los errores si las tablas no existen
-- -- ======================================================================
-- BEGIN EXECUTE IMMEDIATE 'DROP TABLE REVISION CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
-- /
-- BEGIN EXECUTE IMMEDIATE 'DROP TABLE VIAJE CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
-- /
-- BEGIN EXECUTE IMMEDIATE 'DROP TABLE DISPONIBILIDAD CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
-- /
-- BEGIN EXECUTE IMMEDIATE 'DROP TABLE VEHICULO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
-- /
-- BEGIN EXECUTE IMMEDIATE 'DROP TABLE PUNTO_GEOGRAFICO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
-- /
-- BEGIN EXECUTE IMMEDIATE 'DROP TABLE USUARIO_CONDUCTOR CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
-- /
-- BEGIN EXECUTE IMMEDIATE 'DROP TABLE USUARIO_SERVICIO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
-- /
-- BEGIN EXECUTE IMMEDIATE 'DROP TABLE USUARIO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
-- /
-- BEGIN EXECUTE IMMEDIATE 'DROP TABLE SERVICIO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
-- /
-- BEGIN EXECUTE IMMEDIATE 'DROP TABLE CIUDAD CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
-- /

-- -- ======================================================================
-- -- TABLAS BASE (PK manual: ID NUMBER PRIMARY KEY)
-- -- ======================================================================

-- CREATE TABLE USUARIO (
--   ID        NUMBER PRIMARY KEY,
--   TIPO      VARCHAR2(20) CHECK (TIPO IN ('SERVICIO','CONDUCTOR')) NOT NULL,
--   NOMBRE    VARCHAR2(120) NOT NULL,
--   CORREO    VARCHAR2(120),
--   TELEFONO  VARCHAR2(30),
--   CEDULA    VARCHAR2(30),
--   CONSTRAINT UK_USUARIO_CORREO UNIQUE (CORREO)
-- );

-- CREATE TABLE USUARIO_SERVICIO (
--   ID NUMBER PRIMARY KEY,
--   TARJETA_NUM    VARCHAR2(30),
--   TARJETA_NOMBRE VARCHAR2(120),
--   TARJETA_VENCE  VARCHAR2(7),  -- MM/YYYY
--   TARJETA_CVV    VARCHAR2(4),
--   CONSTRAINT FK_USUSERV_USUARIO FOREIGN KEY (ID) REFERENCES USUARIO(ID) ON DELETE CASCADE
-- );

-- CREATE TABLE USUARIO_CONDUCTOR (
--   ID NUMBER PRIMARY KEY,
--   LICENCIA VARCHAR2(30) NOT NULL,
--   EXPIRA   DATE NOT NULL,
--   CONSTRAINT FK_COND_USUARIO FOREIGN KEY (ID) REFERENCES USUARIO(ID) ON DELETE CASCADE
-- );

-- CREATE TABLE CIUDAD (
--   ID NUMBER PRIMARY KEY,
--   NOMBRE VARCHAR2(80) NOT NULL,
--   CONSTRAINT UK_CIUDAD UNIQUE (NOMBRE)
-- );

-- CREATE TABLE PUNTO_GEOGRAFICO (
--   ID NUMBER PRIMARY KEY,
--   NOMBRE     VARCHAR2(120),
--   DIRECCION  VARCHAR2(200),
--   LAT        NUMBER(10,6),
--   LON        NUMBER(10,6),
--   CIUDAD_ID  NUMBER NOT NULL,
--   CONSTRAINT FK_PUNTO_CIUDAD FOREIGN KEY (CIUDAD_ID) REFERENCES CIUDAD(ID)
-- );

-- CREATE TABLE SERVICIO (
--   ID NUMBER PRIMARY KEY,
--   TIPO        VARCHAR2(30) NOT NULL,      -- PASAJEROS, COMIDA, MERCANCIAS
--   NIVEL       VARCHAR2(20),               -- Para PASAJEROS: ESTANDAR, CONFORT, LARGE; NULL en otros
--   TARIFA_BASE NUMBER(10,2) NOT NULL,
--   CONSTRAINT CHK_SERVICIO_NIVEL CHECK (
--     (TIPO = 'PASAJEROS' AND NIVEL IN ('ESTANDAR','CONFORT','LARGE'))
--     OR (TIPO IN ('COMIDA','MERCANCIAS') AND NIVEL IS NULL)
--   )
-- );

-- CREATE TABLE VEHICULO (
--   ID NUMBER PRIMARY KEY,
--   TIPO    VARCHAR2(20) NOT NULL,          -- CARRO, CAMIONETA, MOTOCICLETA
--   MARCA   VARCHAR2(60),
--   MODELO  NUMBER(4),
--   COLOR   VARCHAR2(30),
--   PLACA   VARCHAR2(15) NOT NULL,
--   CIUDAD_EXP_PLACA_ID NUMBER,             -- opcional
--   CAPACIDAD NUMBER(3) DEFAULT 4,
--   CONDUCTOR_ID NUMBER NOT NULL,
--   CONSTRAINT UK_VEH_PLACA UNIQUE (PLACA),
--   CONSTRAINT FK_VEH_COND   FOREIGN KEY (CONDUCTOR_ID)        REFERENCES USUARIO_CONDUCTOR(ID) ON DELETE CASCADE,
--   CONSTRAINT FK_VEH_CIUDAD FOREIGN KEY (CIUDAD_EXP_PLACA_ID) REFERENCES CIUDAD(ID)
-- );

-- CREATE TABLE DISPONIBILIDAD (
--   ID NUMBER PRIMARY KEY,
--   CONDUCTOR_ID NUMBER NOT NULL,
--   INICIO TIMESTAMP NOT NULL,
--   FIN    TIMESTAMP NOT NULL,
--   SERVICIO_ID NUMBER,                      -- quÃ© servicio presta en ese bloque
--   CONSTRAINT FK_DISP_COND FOREIGN KEY (CONDUCTOR_ID) REFERENCES USUARIO_CONDUCTOR(ID),
--   CONSTRAINT FK_DISP_SERV FOREIGN KEY (SERVICIO_ID) REFERENCES SERVICIO(ID),
--   CONSTRAINT CHK_DISP_INTERVAL CHECK (FIN > INICIO)
-- );

-- CREATE TABLE VIAJE (
--   ID NUMBER PRIMARY KEY,
--   USUARIO_SERVICIO_ID NUMBER NOT NULL,
--   CONDUCTOR_ID        NUMBER NOT NULL,
--   VEHICULO_ID         NUMBER NOT NULL,
--   SERVICIO_ID         NUMBER,
--   ORIGEN_ID           NUMBER NOT NULL,
--   DESTINO_ID          NUMBER NOT NULL,
--   FECHA_SALIDA        TIMESTAMP NOT NULL,
--   FECHA_LLEGADA       TIMESTAMP,
--   DISTANCIA_KM        NUMBER(10,3),
--   PRECIO              NUMBER(12,2),
--   ESTADO              VARCHAR2(20) CHECK (ESTADO IN ('CREADO','ASIGNADO','EN_CURSO','FINALIZADO','CANCELADO')),
--   CONSTRAINT FK_VIAJE_USUARIOSERV FOREIGN KEY (USUARIO_SERVICIO_ID) REFERENCES USUARIO_SERVICIO(ID),
--   CONSTRAINT FK_VIAJE_COND         FOREIGN KEY (CONDUCTOR_ID)        REFERENCES USUARIO_CONDUCTOR(ID),
--   CONSTRAINT FK_VIAJE_VEH          FOREIGN KEY (VEHICULO_ID)         REFERENCES VEHICULO(ID),
--   CONSTRAINT FK_VIAJE_SERV         FOREIGN KEY (SERVICIO_ID)         REFERENCES SERVICIO(ID),
--   CONSTRAINT FK_VIAJE_ORIGEN       FOREIGN KEY (ORIGEN_ID)           REFERENCES PUNTO_GEOGRAFICO(ID),
--   CONSTRAINT FK_VIAJE_DESTINO      FOREIGN KEY (DESTINO_ID)          REFERENCES PUNTO_GEOGRAFICO(ID),
--   CONSTRAINT CHK_VIAJE_TIEMPOS CHECK (FECHA_LLEGADA IS NULL OR FECHA_LLEGADA >= FECHA_SALIDA)
-- );

-- CREATE TABLE REVISION (
--   ID NUMBER PRIMARY KEY,
--   VEHICULO_ID NUMBER NOT NULL,
--   FECHA       TIMESTAMP NOT NULL,
--   TIPO        VARCHAR2(40) NOT NULL,   -- TECNICOMECA, EMISIONES, MANTENIMIENTO
--   APROBADA    CHAR(1) CHECK (APROBADA IN ('S','N')) NOT NULL,
--   OBSERVACION VARCHAR2(4000),
--   CONSTRAINT FK_REV_VEH FOREIGN KEY (VEHICULO_ID) REFERENCES VEHICULO(ID)
-- );

-- -- ======================================================================
-- -- INDICES para performance de consultas y joins
-- -- ======================================================================
-- CREATE INDEX IX_VIAJE_USUARIOSERV ON VIAJE(USUARIO_SERVICIO_ID);
-- CREATE INDEX IX_VIAJE_COND        ON VIAJE(CONDUCTOR_ID);
-- CREATE INDEX IX_VIAJE_VEH         ON VIAJE(VEHICULO_ID);
-- CREATE INDEX IX_VIAJE_ORIGEN      ON VIAJE(ORIGEN_ID);
-- CREATE INDEX IX_VIAJE_DESTINO     ON VIAJE(DESTINO_ID);

